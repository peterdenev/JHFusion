!function(a,b){"function"==typeof define&&define.amd?define("JHFusion",[],b):"object"==typeof exports?module.exports=b():a.JHFusion=b()}(this,function(){function d(a,b,c,d,e){e="undefined"!=typeof e?e:!1;var f=function(a){for(var f in a)if(-1!==b.indexOf(a[f].name)&&(c.apply(this,d),e))break};return Object.observe(a,f),f}function e(a,b,c){var d=(b||"").split(",");for(var e in d){var f=d[e].trim().split(" ").map(function(a){return a.trim()}).filter(function(a){return""!=a});if(1==f.length&&(f.push("<<>"),f.push(f[0]),f[0]="val"),f.length>2&&""!=f[2]){var g=(f[1].match(/</g)||[]).length,h=(f[1].match(/>/g)||[]).length,i=2==g?"html":2==h?"js":null;c(function(a,b){var c=["val","html","text"];return{varName:b[2],canRead:g>0,canWrite:h>0,initCopyTo:i,valueFromHTML:function(){return-1!=c.indexOf(b[0])?a[b[0]]():a.attr(b[0])},valueToHTML:function(d){return-1!=c.indexOf(b[0])?a[b[0]](d):(a.attr(b[0],d),void 0)}}}(a,f))}}}function f(b,c,e){var f=!1,g=(c.attr(a+"trigers")||"").split(",").map(function(a){return a.trim()}).filter(function(a){return"!"==a?(f=!0,!1):!0}),h=q(b,c.attr(a+"handler")||"");if(h){var i=d(b,g,h,[b,c]);e.jsChangeHandler=i,f&&h(b,c)}}function g(b,c,d){c.each(function(){$.each(this.attributes,function(){if(this.specified&&0==this.name.indexOf(a+"on")){var e=this.value.split("("),f=[];e.length>1&&(f=e[1].split(")")[0].trim().split(",").map(function(a){return a.trim()}));var g=this.name.substr((a+"on").length);d.ons.hasOwnProperty(g)||(d.ons[g]=[]);var h=function(){q(b,e[0].trim()).apply(this,f)};d.ons[g].push(h),c.on(g,h)}})})}function h(d,h,i,j){j="undefined"!=typeof j?j:e;var k=h.attr(a+"bind-id");if("undefined"==typeof k||i){if("undefined"==typeof k&&(k=b++,h.attr(a+"bind-id",k)),i&&c.hasOwnProperty(k)){for(var l in c[k].observeHandlers){var m=c[k].observeHandlers[l];Object.unobserve(d,m)}for(var n in c[k].ons)h.off(n);c[k].jsChangeHandler&&Object.unobserve(d,c[k].jsChangeHandler)}c[k]={ref_el:h,observeHandlers:[],ons:{change:[]},jsChangeHandler:void 0},j(h,h.attr(a+"models"),function(a){var b=function(){r(a.varName,a.valueFromHTML(),d)};switch(a.initCopyTo){case"js":b();break;case"html":a.valueToHTML(q(d,a.varName))}if(a.canRead){var e=function(b){for(var c in b)b[c].name==a.varName&&a.valueToHTML(q(d,a.varName))};c[k].observeHandlers.push(e),Object.observe(d,e)}a.canWrite&&(c[k].ons.change.push(b),h.on("change",b))}),f(d,h,c[k]),g(d,h,c[k])}return k}function k(b,c,d,e){d="undefined"!=typeof d?d:!0,c="undefined"!=typeof c?c:$("body");var f=[];return $(c).find("["+a+"models]").each(function(){f.push(h(b,$(this),d,e))}),f}function l(b){return $(b.el).attr(a+"models",b.models),$(b.el).attr(a+"trigers",b.trigers),$(b.el).attr(a+"handler",b.handler),h(b.scope,b.el)}function m(a){var b=a.toString();return b=b.substr("function ".length),b=b.substr(0,b.indexOf("(")),b.trim()}function n(a){for(var b in a){var c=a[b],d=m(c);o(d,c)}}function o(b,c){var d=$("["+a+'controller="'+b+'"]');if(d.length){var e=c({});k(e,d)}}function p(a){if(-1!=["number","string"].indexOf(a)&&(a=[a]),"object"==typeof a)for(var b in a)delete c[a[b]]}function q(a,b){b=b.replace(/\[(\w+)\]/g,".$1"),b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var d=c.shift();if(!(d in a))return;a=a[d]}return a}function r(a,b,c){c||(c=data);var d=a.split(/\./);d.length<2?c[d[0]]=b:(c[d[0]]||(c[d[0]]={}),c=c[d.shift()],r(d.join("."),b,c))}var a="data-",b=0,c={};return{attr_pfx:a,bindHtml:k,controllers:n,controller:o,fill:l,bindedElementsHandlers:c,bindOne:h,clearHandlers:p}});